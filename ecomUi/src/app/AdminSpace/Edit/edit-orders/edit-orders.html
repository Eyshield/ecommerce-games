<div class="flex bg-gray-50 h-screen w-screen">
  <app-side-bar-admin></app-side-bar-admin>
  <div class="flex-1 overflow-y-auto">
    <div class="flex items-center justify-center min-h-full p-6">
      <div class="w-full max-w-2xl">
        <h1 class="text-3xl font-bold mb-6 text-gray-900 text-center">
          Edit Order
        </h1>
        <form
          [formGroup]="orderForm"
          class="bg-white shadow-md rounded px-8 pt-6 pb-8"
        >
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div>
              <label
                class="block text-gray-700 text-sm font-bold mb-2"
                for="customerName"
              >
                Customer Name
              </label>
              <input
                type="text"
                [formControl]="userSearch"
                class="shadow border rounded w-full py-2 px-3"
                [class.border-red-500]="
                  orderForm.get('userId')?.invalid &&
                  orderForm.get('userId')?.touched
                "
                placeholder="Enter Customer  ..."
              />
              <ul>
                <li>
                  @for (customer of customers().content; track $index) {
                    <div
                      class="p-2 hover:bg-gray-100 cursor-pointer"
                      (click)="selectCustomer(customer)"
                    >
                      {{ customer.nom }} {{ customer.prenom }}
                    </div>
                  }
                </li>
              </ul>

              @if (
                orderForm.get("userId")?.invalid &&
                orderForm.get("userId")?.touched
              ) {
                <p class="text-red-500 text-sm mt-1">Customer is required</p>
              }
            </div>
          </div>

          <div formArrayName="orderItemRequests">
            @for (item of orderItems.controls; track item; let i = $index) {
              <div
                [formGroupName]="i"
                class="border rounded p-4 mb-4 bg-gray-50"
              >
                <div class="mb-3">
                  <label class="block text-gray-700 text-sm font-bold mb-2">
                    Game
                  </label>

                  <input
                    formControlName="searchControl"
                    (input)="onGameSearch($any($event.target).value, i)"
                    class="shadow border rounded w-full py-2 px-3"
                    [class.border-red-500]="
                      item.get('gameId')?.invalid && item.get('gameId')?.touched
                    "
                    placeholder="searchGame ..."
                  />
                  <ul class="border rounded mt-2 max-h-40 overflow-y-auto">
                    @for (games of games().content; track $index) {
                      <li
                        class="p-2 hover:bg-gray-100 cursor-pointer"
                        (click)="selectGame(games, i)"
                      >
                        {{ games.title }}
                      </li>
                    }
                  </ul>
                  @if (
                    item.get("gameId")?.invalid && item.get("gameId")?.touched
                  ) {
                    <p class="text-red-500 text-xs italic mt-1">
                      Game is required
                    </p>
                  }
                </div>

                <div class="mb-3">
                  <label class="block text-gray-700 text-sm font-bold mb-2">
                    Quantity
                  </label>

                  <input
                    type="number"
                    min="1"
                    formControlName="quantity"
                    class="shadow border rounded w-full py-2 px-3"
                    [class.border-red-500]="
                      item.get('quantity')?.invalid &&
                      item.get('quantity')?.touched
                    "
                  />
                  @if (
                    item.get("quantity")?.invalid &&
                    item.get("quantity")?.touched
                  ) {
                    <p class="text-red-500 text-xs italic mt-1">
                      @if (item.get("quantity")?.errors?.["required"]) {
                        Quantity is required
                      }
                      @if (item.get("quantity")?.errors?.["min"]) {
                        Quantity must be at least 1
                      }
                    </p>
                  }
                </div>

                <button
                  type="button"
                  (click)="removeItem(i)"
                  class="text-red-600 text-sm hover:text-red-800"
                >
                  Remove
                </button>
              </div>
            }
          </div>
          <div class="mb-6">
            <button
              type="button"
              (click)="addItem()"
              class="bg-gray-200 hover:bg-gray-300 px-4 py-2 rounded"
            >
              Add Game
            </button>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div>
              <label
                class="block text-gray-700 text-sm font-bold mb-2"
                for="orderDate"
              >
                Order Date
              </label>
              <input
                class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                [class.border-red-500]="
                  orderForm.get('orderDate')?.invalid &&
                  orderForm.get('orderDate')?.touched
                "
                id="orderDate"
                formControlName="orderDate"
                type="date"
              />
              @if (
                orderForm.get("orderDate")?.invalid &&
                orderForm.get("orderDate")?.touched
              ) {
                <p class="text-red-500 text-xs italic mt-1">
                  Order date is required
                </p>
              }
            </div>

            <div>
              <label
                class="block text-gray-700 text-sm font-bold mb-2"
                for="status"
              >
                Status
              </label>
              <select
                class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                [class.border-red-500]="
                  orderForm.get('status')?.invalid &&
                  orderForm.get('status')?.touched
                "
                id="status"
                formControlName="status"
              >
                <option value="" disabled selected>Select status</option>
                <option value="Pending">Pending</option>
                <option value="Processing">Processing</option>
                <option value="Completed">Completed</option>
                <option value="Cancelled">Cancelled</option>
              </select>
              @if (
                orderForm.get("status")?.invalid &&
                orderForm.get("status")?.touched
              ) {
                <p class="text-red-500 text-xs italic mt-1">
                  Status is required
                </p>
              }
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div>
              <label
                class="block text-gray-700 text-sm font-bold mb-2"
                for="totalAmount"
              >
                Total Amount
              </label>
              <input
                class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                [class.border-red-500]="
                  orderForm.get('totalAmount')?.invalid &&
                  orderForm.get('totalAmount')?.touched
                "
                id="totalAmount"
                formControlName="totalAmount"
                type="number"
                min="0"
                step="0.01"
                placeholder="Enter total amount"
              />
              @if (
                orderForm.get("totalAmount")?.invalid &&
                orderForm.get("totalAmount")?.touched
              ) {
                <p class="text-red-500 text-xs italic mt-1">
                  @if (orderForm.get("totalAmount")?.errors?.["required"]) {
                    Total amount is required
                  }
                  @if (orderForm.get("totalAmount")?.errors?.["min"]) {
                    Total amount must be greater than 0
                  }
                </p>
              }
            </div>
          </div>

          <div class="mb-6">
            <label
              class="block text-gray-700 text-sm font-bold mb-2"
              for="shippingAddress"
            >
              Shipping Address
            </label>
            <textarea
              class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline resize-none"
              [class.border-red-500]="
                orderForm.get('shippingAddress')?.invalid &&
                orderForm.get('shippingAddress')?.touched
              "
              id="shippingAddress"
              formControlName="shippingAddress"
              rows="3"
              placeholder="Enter shipping address"
            ></textarea>
            @if (
              orderForm.get("shippingAddress")?.invalid &&
              orderForm.get("shippingAddress")?.touched
            ) {
              <p class="text-red-500 text-xs italic mt-1">
                Shipping address is required
              </p>
            }
          </div>

          <div class="flex items-center justify-center">
            <button
              (click)="updateOrder()"
              class="bg-blue-500 hover:bg-blue-700 rounded-lg text-white font-bold py-2 px-4 focus:outline-none focus:shadow-outline disabled:opacity-50 disabled:cursor-not-allowed"
              type="button"
            >
              Edit Order
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
