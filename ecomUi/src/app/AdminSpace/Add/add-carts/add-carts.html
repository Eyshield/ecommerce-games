<div class="flex bg-gray-50 h-screen w-screen">
  <app-side-bar-admin></app-side-bar-admin>
  <div class="flex-1 overflow-y-auto">
    <div class="flex items-center justify-center min-h-full p-6">
      <div class="w-full max-w-2xl">
        <h1 class="text-3xl font-bold mb-6 text-gray-900 text-center">
          Add New Carts
        </h1>
        <form
          [formGroup]="cartForm"
          class="bg-white shadow-md rounded px-8 pt-6 pb-8"
        >
          <div class="mb-4">
            <label class="block text-gray-700 text-sm font-bold mb-2">
              Customer
            </label>

            <input
              type="text"
              [formControl]="userSearch"
              class="shadow border rounded w-full py-2 px-3"
              [class.border-red-500]="
                cartForm.get('userId')?.invalid &&
                cartForm.get('userId')?.touched
              "
              placeholder="Enter Customer  ..."
            />
            <ul>
              <li>
                @for (customer of customers().content; track $index) {
                  <div
                    class="p-2 hover:bg-gray-100 cursor-pointer"
                    (click)="selectCustomer(customer)"
                  >
                    {{ customer.nom }} {{ customer.prenom }}
                  </div>
                }
              </li>
            </ul>

            @if (
              cartForm.get("userId")?.invalid && cartForm.get("userId")?.touched
            ) {
              <p class="text-red-500 text-sm mt-1">Customer is required</p>
            }
          </div>

          <div formArrayName="cartItemRequests">
            @for (item of cartItems.controls; track item; let i = $index) {
              <div
                [formGroupName]="i"
                class="border rounded p-4 mb-4 bg-gray-50"
              >
                <div class="mb-3">
                  <label class="block text-gray-700 text-sm font-bold mb-2">
                    Game
                  </label>

                  <input
                    formControlName="searchControl"
                    (input)="onGameSearch($any($event.target).value, i)"
                    class="shadow border rounded w-full py-2 px-3"
                    [class.border-red-500]="
                      item.get('gameId')?.invalid && item.get('gameId')?.touched
                    "
                    placeholder="searchGame ..."
                  />
                  <ul class="border rounded mt-2 max-h-40 overflow-y-auto">
                    @for (games of games().content; track $index) {
                      <li
                        class="p-2 hover:bg-gray-100 cursor-pointer"
                        (click)="selectGame(games, i)"
                      >
                        {{ games.title }}
                      </li>
                    }
                  </ul>
                  @if (
                    item.get("gameId")?.invalid && item.get("gameId")?.touched
                  ) {
                    <p class="text-red-500 text-xs italic mt-1">
                      Game is required
                    </p>
                  }
                </div>

                <div class="mb-3">
                  <label class="block text-gray-700 text-sm font-bold mb-2">
                    Quantity
                  </label>

                  <input
                    type="number"
                    min="1"
                    formControlName="quantity"
                    class="shadow border rounded w-full py-2 px-3"
                    [class.border-red-500]="
                      item.get('quantity')?.invalid &&
                      item.get('quantity')?.touched
                    "
                  />
                  @if (
                    item.get("quantity")?.invalid &&
                    item.get("quantity")?.touched
                  ) {
                    <p class="text-red-500 text-xs italic mt-1">
                      @if (item.get("quantity")?.errors?.["required"]) {
                        Quantity is required
                      }
                      @if (item.get("quantity")?.errors?.["min"]) {
                        Quantity must be at least 1
                      }
                    </p>
                  }
                </div>

                <button
                  type="button"
                  (click)="removeItem(i)"
                  class="text-red-600 text-sm hover:text-red-800"
                >
                  Remove
                </button>
              </div>
            }
          </div>

          <div class="mb-6">
            <button
              type="button"
              (click)="addItem()"
              class="bg-gray-200 hover:bg-gray-300 px-4 py-2 rounded"
            >
              Add Game
            </button>
          </div>

          <div class="flex justify-center">
            <button
              (click)="addCart()"
              [disabled]="cartForm.invalid"
              class="bg-blue-500 hover:bg-blue-700 rounded-lg text-white font-bold py-2 px-6 disabled:opacity-50 disabled:cursor-not-allowed"
            >
              Add Cart
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
